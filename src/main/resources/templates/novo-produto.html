<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Novo Produto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow p-4">
        <h2 class="mb-4">➕ Cadastrar Novo Produto</h2>

        <form th:action="@{/app/produtos/salvar}"
      th:object="${produto}"
      method="post"
      enctype="multipart/form-data"
      class="p-4 bg-white shadow rounded">


    <h3 class="mb-4">
        <i class="bi bi-bag-plus-fill"></i> Cadastrar Novo Produto
    </h3>

    <!-- Nome -->
    <div class="mb-3">
        <label for="nome" class="form-label">Nome</label>
        <input type="text" class="form-control" id="nome" name="nome" th:value="${produto?.nome}">
    </div>

    <!-- Descrição -->
    <div class="mb-3">
        <label for="descricao" class="form-label">Descrição</label>
        <textarea class="form-control" id="descricao" name="descricao" rows="3"
                  th:text="${produto?.descricao}"></textarea>
    </div>

    <div class="mb-3">
		<label for="preco" class="form-label">Preço</label>
		<input type="text" class="form-control" id="preco" th:field="*{preco}" placeholder="R$ 0,00" oninput="formatarPreco(this)" />
	</div>

    <!-- Categoria -->
    <div class="mb-3">
        <label for="categoria" class="form-label">Categoria</label>
        <select class="form-select" id="categoria" name="categoria.id" required>
            <option th:each="cat : ${categorias}"
                    th:value="${cat.id}"
                    th:text="${cat.nome}"
                    th:selected="${produto?.categoria?.id == cat.id}"></option>
        </select>
    </div>
    
    <!-- Campo de imagem -->
    <div class="mb-3">
        <label for="file" class="form-label">Imagem</label>
        <input type="file" class="form-control" id="file" name="file" accept="image/*">
    </div>

    <!-- Botão -->
    <button type="submit" class="btn btn-primary">Salvar</button>
    <a th:href="@{/app/produtos}" class="btn btn-secondary">Cancelar</a>
</form>


    </div>
</div>

</body>
</html>

<script>
function formatarPreco(input) {
  let valor = input.value.replace(/\D/g, ""); // remove tudo que não é número
  valor = (valor / 100).toFixed(2) + ""; // divide por 100 e fixa duas casas
  valor = valor.replace(".", ","); // troca ponto por vírgula
  valor = valor.replace(/\B(?=(\d{3})+(?!\d))/g, "."); // adiciona pontos de milhar
  input.value = "R$ " + valor;
}
</script>